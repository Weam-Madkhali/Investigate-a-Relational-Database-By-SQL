/*QUERY 1- query used for first insight*/
SELECT actorID, actor_name,
COUNT(*) num_film

FROM
  ( SELECT a.actor_id AS actorID
  ,a.first_name, a.last_name,
  a.first_name||' '||a.last_name AS actor_name

  FROM actor a
  JOIN film_actor fa
  ON a.actor_id = fa.film_id
  JOIN film f
  ON f.film_id=fa.film_id) t1

GROUP BY 1,2
HAVING COUNT(*) > 2
ORDER BY 3 DESC;

/*QUERY 2- query used for second insight*/

SELECT c.name AS category,f.rental_rate,
 AVG(f.rental_rate)OVER (ORDER BY c.name) AS AVG_rental_rate

FROM category c

JOIN film_category fc

ON c.category_id=fc.category_id

JOIN film f

ON f.film_id=fc.film_id

ORDER BY 2 DESC;

/*QUERY 3- query used for third insight*/

SELECT customerID, customer_name,
COUNT(*)tot_rental
FROM
  (SELECT cu.customer_id AS customerID
   ,cu.first_name, cu.last_name,
   cu.first_name||' '||cu.last_name AS customer_name,
   p.payment_id

   FROM customer cu
   JOIN rental r
   ON cu.customer_id=r.customer_id
   JOIN payment p
   ON p.rental_id=r.rental_id)t1

GROUP BY 1,2
ORDER BY 3 DESC
LIMIT 20;

/*QUERY 4- query used for final insight*/

SELECT a.last_name, f.title,
 COUNT(*) num_films

FROM actor a
JOIN film_actor fa
ON a.actor_id = fa.film_id
JOIN film f
ON f.film_id=fa.film_id

GROUP BY 1,2
ORDER BY 3
LIMIT 3;
